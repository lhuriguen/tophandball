{% extends "data/base_club.html" %}
{% block active_info %}active{% endblock %}

{% block specific %}
<div class="row">
    <div class="col-md-3">
        <div class="panel panel-default">
            <div class="panel-body">
                <small>
                    <strong>Country: </strong> {{ club.country }}<br>
                    <strong>Short name: </strong> {{ club.short_name }}<br>
                    <strong>Initials: </strong> {{ club.initials }}<br>
                    <hr>
                    <strong>Website: </strong> {{ club.website|urlize }}<br>
                    <strong>Twitter: </strong> {{ club.twitter|urlize }}<br>
                    <strong>Facebook: </strong> {{ club.facebook|urlize }}<br>
                    <hr>
                    <strong>Address:</strong><br>
                    {{ club.address }}
                    <hr>
                    <strong>Also known as:</strong>
                    <ul class="list-unstyled">
                    {% for clubname in club.clubname_set.all %}
                        <li>{{ clubname.season }} - {{ clubname.name }}</li>
                    {% empty %}
                        <li>No alternative names found.</li>
                    {% endfor %}
                    </ul>
                    <hr>
                    <p><i class="fa fa-edit"></i> Is this information wrong or incomplete? You can fix it <a href="{% url 'data:club_update' pk=club.id %}">here</a>.</p>
                </small>
            </div>
        </div>
        <div id="map_canvas" class="thumbnail">{% if not club.address %}Sorry, cannot show map without an address.{% endif %}</div>
    </div>
    <div class="col-md-6">
        <div class="panel panel-primary">
            <div class="panel-heading">
                <h3 class="panel-title"><i class="fa fa-bar-chart-o"></i> {{ club.name }}'s Competitions</h3>
            </div>
            <table class="table table-hover">
                <thead>
                    <tr>
                        <th>Season</th>
                        <th>Comp.</th>
                        <th>Stage</th>
                        <th>#</th>
                    </tr>
                </thead>
                <tbody>
                    {% for gt in comp_list %}
                    <tr>
                        <td>{{ gt.group.stage.comp_season.season }}</td>
                        <td><a href="{{ gt.group.stage.comp_season.competition.get_absolute_url }}">{{ gt.group.stage.comp_season.competition.short_name }}</a></td>
                        <td><a href="#">{{ gt.group.stage.name }}</a></td>
                        <td>{{ gt.position }}</td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
            <div class="panel-footer">
                <p class="panel-title text-center"><a href="{% url 'data:club_matches' pk=club.id %}">Match History</a></p>
            </div>
        </div>
    </div>
    <div class="col-md-3">
        <div class="panel panel-primary">
            <div class="panel-heading">
                <h3 class="panel-title"><i class="fa fa-group"></i> Current players</h3>
            </div>
            <div class="list-group media-list">
                {% for player in club.get_current_team %}
                <a href="{{ player.player.get_absolute_url }}" class="list-group-item media">
                    <div class="pull-left">
                      <img class="media-object" src="{{ player.player.photo_url }}" alt="{{ player.player.full_name }}">
                    </div>
                    <div class="media-body">
                      <h5 class="list-group-item-heading">{{ player.player.full_name }}</h5>
                      <small>{{ player.player.get_position_display }}</small>
                    </div>
                </a>
                {% empty %}
                <a href="#" class="list-group-item">No players found.</a>
                {% endfor %}
            </div>
            <div class="panel-footer">
                <p class="panel-title text-center"><a href="#">Player History</a></p>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_script %}
<script src="https://maps.googleapis.com/maps/api/js?sensor=false"></script>
<script>
    var geocoder, map;

    function codeAddress(address) {
        geocoder = new google.maps.Geocoder();
        geocoder.geocode({
            'address': address
        }, function(results, status) {
            if (status == google.maps.GeocoderStatus.OK) {
                var myOptions = {
                    zoom: 8,
                    center: results[0].geometry.location,
                    mapTypeId: google.maps.MapTypeId.ROADMAP
                }
                map = new google.maps.Map(document.getElementById("map_canvas"), myOptions);

                var marker = new google.maps.Marker({
                    map: map,
                    position: results[0].geometry.location
                });
            }
        });
    }
    google.maps.event.addDomListener(window, 'load', codeAddress("{{ club.address }}"));
</script>
<script type="text/javascript">

    $(document).on('submit', '#follow_form', function()  {
        var frm = $('#follow_form');
        $.ajax({
            type: frm.attr('method'),
            url: frm.attr('action'),
            data: frm.serialize(),
            success: function (data) {
                $(".top-button-bar").html(data);
            },
            error: function(data) {
                alert("Something went wrong!");
            }
        });
        return false;
    });

</script>
{% endblock %}
