{% extends "data/base_club.html" %}
{% block active_info %}active{% endblock %}
{% block specific %}

<div class="row" id="info">
    <div class="col-sm-6 col-md-3">
        <img class="img-logo" src="{{ club.logo_url }}" alt="logo">
    </div>
    <div class="col-sm-6 col-md-3">
        <strong>Also known as</strong>
        <ul class="list-unstyled">
            {% for clubname in club.clubname_set.all %}
            <li>{{ clubname.season }} - {{ clubname.name }}</li>
            {% empty %}
            <li>No alternative names found.</li>
            {% endfor %}
        </ul>
    </div>
    <div class="clearfix visible-sm"></div>
    <div class="col-sm-6 col-md-3">
        <address>
            <strong>Address</strong><br>
            {% for line in club.address_lines %}
            {{ line }}<br>
            {% empty %}
            Address unknown.
            {% endfor %}
        </address>
        <address>
            <strong>Online</strong><br>
            <a href="{{ club.website }}">{{ club.website }}</a><br>
            <a href="{{ club.twitter }}">{{ club.twitter }}</a><br>
            <a href="{{ club.facebook }}">{{ club.facebook }}</a>
        </address>
    </div>
    <div class="col-sm-6 col-md-3">
        <div id="map_canvas" class="thumbnail">{% if not club.address_lines %}Sorry, cannot show map without an address.{% endif %}</div>
    </div>
</div>
<div class="row">
    <div class="col-md-9" role="main"  id="players">
        {% regroup club.get_current_team|dictsort:"player.position" by player.get_position_display as position_list %}
        {% for position in position_list %}
        <div class="panel panel-default">
            <div class="panel-heading">
                <h3 class="panel-title" id="{{ position.grouper }}">{{ position.grouper }}{{ position.list|length|pluralize }}</h3>
            </div>
            <div class="panel-body">
                <div class="row">
                    {% for player in position.list %}
                    {% if forloop.counter|divisibleby:3 %}
                    <div class="clearfix visible-sm"></div>
                    {% endif %}
                    <div class="col-sm-6 col-md-3">
                        <a href="{{ player.player.get_absolute_url }}">
                            <img class="thumbnail img-person" src="{{ player.player.photo_url }}" alt="photo">
                        </a>
                        <div class="caption">
                            <h4>{{ player.player.full_name }}
                                <small>{{ player.player.country }}</small>
                            </h4>
                            <p>
                                <span class="badge">#{{ player.shirt_number }}</span> Since {{ player.from_date|date:"F Y" }}</p>
                            <!-- <p><a href="{{ player.player.get_absolute_url }}" class="btn btn-primary" role="button">View</a> <a href="#" class="btn btn-default"><span class="glyphicon glyphicon-star"></span> Star</a></p> -->
                        </div>
                        <!-- </div> -->
                    </div>
                    {% if forloop.counter|divisibleby:4 %}
                </div>
                <div class="row">
                    {% endif %} {% endfor %}
                </div>
            </div>
        </div>
        {% empty %} {% endfor %}

        <div class="panel panel-default">
            <div class="panel-heading">
                <h3 class="panel-title" id="coach">Coaches</h3>
            </div>
            <div class="panel-body">
                <div class="row">
                    {% for coach in club.get_current_coaches %}
                    {% if forloop.counter|divisibleby:3 %}
                    <div class="clearfix visible-sm"></div>
                    {% endif %}
                    <div class="col-sm-6 col-md-3">
                        <a href="{{ coach.coach.get_absolute_url }}">
                            <img class="thumbnail img-person" src="{{ coach.coach.photo_url }}" alt="photo">
                        </a>
                        <div class="caption">
                            <h4>{{ coach.coach.full_name }} <small>{{ coach.coach.country }}</small></h4>
                            <p>{{ coach.get_role_display }}. Since {{ coach.from_date|date:"F Y" }}</p>
                        </div>
                    </div>
                    {% if forloop.counter|divisibleby:4 %}
                </div>
                <div class="row">
                    {% endif %}
                    {% empty %}
                    <div class="col-sm-6 col-md-3">
                        <p>No current coach found.</p>
                    </div>
                    {% endfor %}
                </div>
            </div>
        </div>

    </div>

    <div class="col-md-3">
        <ul class="nav hidden-print" id="sidebar" role="complementary">
            {% for position in position_list %}
            <li><a href="#{{ position.grouper }}">{{ position.grouper }}</a>
            </li>
            {% endfor %}
        </ul>
    </div>
</div>

{% endblock %}
{% block extra_script %}
<script src="https://maps.googleapis.com/maps/api/js?sensor=false"></script>
<script>
    var geocoder, map;

    function codeAddress(address) {
        geocoder = new google.maps.Geocoder();
        geocoder.geocode({
            'address': address
        }, function(results, status) {
            if (status == google.maps.GeocoderStatus.OK) {
                var myOptions = {
                    zoom: 8,
                    center: results[0].geometry.location,
                    mapTypeId: google.maps.MapTypeId.ROADMAP
                }
                map = new google.maps.Map(document.getElementById("map_canvas"), myOptions);

                var marker = new google.maps.Marker({
                    map: map,
                    position: results[0].geometry.location
                });
            }
        });
    }
    google.maps.event.addDomListener(window, 'load', codeAddress("{{ club.address }}"));
</script>
<script type="text/javascript">

    // var $body   = $(document.body);
    // var navHeight = $('.navbar').outerHeight(true) + 10;

    // $body.scrollspy({
    //     target: '#leftCol',
    //     offset: navHeight
    // });

    var topHeight = $('.navbar').outerHeight(true) + $('#header').outerHeight(true) + $('#info').outerHeight(true);

    $('#sidebar').affix({
        offset: {
          top: topHeight
        , bottom: function () {
            return (this.bottom = $('#footer').outerHeight(true))
          }
        }
    })

    // $('a.scroll').click(function(event){
    //     event.preventDefault();
    //     $('#players').animate({
    //         scrollTop:$(this.hash).offset().top - $('.navbar').outerHeight()
    //     }, 550);
    // })

</script>
{% endblock %}
